
require 'rake/rdoctask'
require 'rake/packagetask'
require 'rake/gempackagetask'
require 'rake/testtask'
require 'rubygems'

PKG_VERSION = "0.6.2"

desc "Create HTML documentation from RDOC"
Rake::RDocTask.new do |rd|
  rd.main = "README"
  rd.rdoc_files.include("README", "CHANGES", "IMPLEMENTATION", "DEVELOPER",
                        "lib/**/*.rb", "test/**/*.rb", "examples/**/*.rb")
end

desc "Make tar distribution"
Rake::PackageTask.new('syndication', PKG_VERSION) do |t|
  t.need_tar_bz2 = true
  t.package_files.include("README", "CHANGES", "IMPLEMENTATION", "DEVELOPER", "lib/**/*.rb", "test/**/*.rb", "examples/**/*.rb", "rakefile", "setup.rb")
  t.package_dir = "pkg"
end

spec = Gem::Specification.new do |s|
  s.name = "syndication"
  s.version = PKG_VERSION
  s.author = "mathew"
  s.email = "meta@pobox.com"
  s.homepage = "http://www.pobox.com/~meta/"
  s.platform = Gem::Platform::RUBY
  s.description = <<-EOF
  Syndication is a parser for RSS and Atom feeds. It uses either REXML or
  its built-in "tag soup" parser for feed parsing. It supports extensions
  to web feeds including Dublin Core metadata, Apple iTunes podcasts, and 
  extensions from Google and Feedburner. It is written in pure Ruby, and
  designed to be easy to understand and extend. It is compatible with Ruby 
  1.8.x and 1.9.x.
  EOF
  s.rubyforge_project = 'syndication'
  s.summary = "A web syndication parser for Atom and RSS with a uniform API"
  candidates = Dir.glob("{bin,docs,lib,test,examples}/**/*")
  candidates << "rakefile"
  s.files = candidates.delete_if do |item|
    item.include?("CVS") || item.include?("html")
  end
  s.require_path = "lib"
  s.test_files = ["test/atomtest.rb", "test/rsstest.rb", "test/google.rb",
                  "test/tagsouptest.rb", "test/feedburntest.rb"]
  s.has_rdoc = true
  s.extra_rdoc_files = ["README", "IMPLEMENTATION", "CHANGES", "DEVELOPER"]
end

desc "Make RubyGems gem distribution"
Rake::GemPackageTask.new(spec) do |pkg|
  pkg.need_zip = true
  pkg.need_tar = true
end

desc "Run unit tests"
Rake::TestTask.new("test") { |t|
  t.pattern = 'test/*.rb'
  t.verbose = true
  t.warning = true
}

task :default do
  puts "This is a pure Ruby library, no compilation is required."
  puts "Try rake --tasks"
end
